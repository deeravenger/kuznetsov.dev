<!doctype html><html dir=ltr lang=ru data-theme=dark class="html theme--dark"><head><title>Дмитрий Кузнецов
|
Как я технический стек пересмотрел
</title><meta charset=utf-8><meta name=generator content="Hugo 0.126.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Дмитрий Кузнецов"><meta name=description content="Как я пересмотрел выбранный технический стек после трёх лет поддержки своего open-source приложения"><link rel=alternate href=/posts/tech-stack-reevaluation/ hreflang=ru><link rel=alternate href=/en/posts/tech-stack-reevaluation/ hreflang=en><link rel=stylesheet href=/scss/main.min.1cac29897bb941adf4246700acb99deffbfdf35a02ffc4ae81484456ebe430c3.css integrity="sha256-HKwpiXu5Qa30JGcArLmd7/v981oC/8SugUhEVuvkMMM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/override.min.582ab7f7a3a821d6afb051ea8d64a1c1c5855671991b429ffe3603fcf937f6cf.css integrity="sha256-WCq396OoIdavsFHqjWShwcWFVnGZG0Kf/jYD/Pk39s8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/404.min.8af5cba8db45fcd9bffa951d2cb07c1b34c55055091a151d255d39bc2ccfc919.css integrity="sha256-ivXLqNtF/Nm/+pUdLLB8GzTFUFUJGhUdJV05vCzPyRk=" crossorigin=anonymous media=screen><link rel=stylesheet href=/fontawesome/css/fontawesome.min.137b1cf3cea9a8adb7884343a9a5ddddf4280f59153f74dc782fb7f7bf0d0519.css integrity="sha256-E3sc886pqK23iENDqaXd3fQoD1kVP3TceC+3978NBRk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.e65dc5b48fb5f39b142360c57c3a215744c94e56c755c929cc3e88fe12aab4d3.css integrity="sha256-5l3FtI+185sUI2DFfDohV0TJTlbHVckpzD6I/hKqtNM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.6f4f16d58da1c82c0c3a3436e021a3d39b4742f741192c546e73e947eacfd92f.css integrity="sha256-b08W1Y2hyCwMOjQ24CGj05tHQvdBGSxUbnPpR+rP2S8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.e10425ad768bc98ff1fb272a0ac8420f9d1ba22f0612c08ff1010c95080ffe7e.css integrity="sha256-4QQlrXaLyY/x+ycqCshCD50boi8GEsCP8QEMlQgP/n4=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=https://kuznetsov.dev/posts/tech-stack-reevaluation/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script><script type=text/javascript src=/js/redirect.min.1a0a0ecc7df8adf287ef6a14f5a4fb7a38bd4cf3e64b85aa9580556790d51e13.js integrity="sha256-GgoOzH34rfKH72oU9aT7eji9TPPmS4WqlYBVZ5DVHhM=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kuznetsov.dev/posts/tech-stack-reevaluation/cover.jpg"><meta name=twitter:title content="Как я технический стек пересмотрел"><meta name=twitter:description content="Как я пересмотрел выбранный технический стек после трёх лет поддержки своего open-source приложения"><meta property="og:url" content="https://kuznetsov.dev/posts/tech-stack-reevaluation/"><meta property="og:site_name" content="Культ Качества"><meta property="og:title" content="Как я технический стек пересмотрел"><meta property="og:description" content="Как я пересмотрел выбранный технический стек после трёх лет поддержки своего open-source приложения"><meta property="og:locale" content="ru"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-06T00:00:00+00:00"><meta property="article:tag" content="Experience"><meta property="og:image" content="https://kuznetsov.dev/posts/tech-stack-reevaluation/cover.jpg"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Как я технический стек пересмотрел","headline":"Как я технический стек пересмотрел","alternativeHeadline":"","description":"
      Как я пересмотрел выбранный технический стек после трёх лет поддержки своего open-source приложения


    ","inLanguage":"ru","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kuznetsov.dev\/posts\/tech-stack-reevaluation\/"},"author":{"@type":"Person","name":"Дмитрий Кузнецов"},"creator":{"@type":"Person","name":"Дмитрий Кузнецов"},"accountablePerson":{"@type":"Person","name":"Дмитрий Кузнецов"},"copyrightHolder":{"@type":"Person","name":"Дмитрий Кузнецов"},"copyrightYear":"2024","dateCreated":"2024-12-06T00:00:00.00Z","datePublished":"2024-12-06T00:00:00.00Z","dateModified":"2024-12-06T00:00:00.00Z","publisher":{"@type":"Organization","name":"Дмитрий Кузнецов","url":"https://kuznetsov.dev/","logo":{"@type":"ImageObject","url":"https:\/\/kuznetsov.dev\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/kuznetsov.dev\/posts\/tech-stack-reevaluation\/","wordCount":"1647","genre":[],"keywords":["experience"]}</script><script defer data-domain=kuznetsov.dev src=https://analytics.xdeer.dev/js/script.file-downloads.outbound-links.tagged-events.js></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
."><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/avatar-qq.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/>Дмитрий Кузнецов</a></div><div class=sidebar__introduction-description><p>Создавай. Улучшай. Автоматизируй.</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/dmitry-kuznetsov-in target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin class=plausible-event-name--linkedin><i class="fab fa-linkedin-in fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/deeravenger target=_blank rel="noopener me" aria-label=GitHub title=GitHub class=plausible-event-name--github><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://t.me/kuznetsov_dev target=_blank rel="noopener me" aria-label=Telegram title=Telegram class=plausible-event-name--telegram><i class="fab fa-telegram-plane fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/deer_avenger target=_blank rel="noopener me" aria-label=Twitter title=Twitter class=plausible-event-name--twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Дмитрий Кузнецов
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class=.><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Блог</a></li><li class=nav__list-item><a href=/posts/ title>Архив блога</a></li><li class=nav__list-item><a href=/about/ title>Обо мне</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=optionswitch><input class=optionswitch__picker type=checkbox id=languagepicker hidden>
<label class=optionswitch__label for=languagepicker>RU <i class="fa fa-angle-down" aria-hidden=true></i></label><div class=optionswitch__triangle></div><ul class=optionswitch__list><li class=optionswitch__list-item><a href=/en/posts/tech-stack-reevaluation/ title=EN><span aria-label=EN>EN</span></a></li></ul></div></li></ul></nav></div></header><div class="post
."><div class=post__content><h1>Как Я Технический Стек Пересмотрел</h1><p>В 2021 году, когда приложение по учету финансов из AppStore потеряло наши данные за 2+ года, я собрал MVP <a href=https://econumo.com>econumo</a> за 2 недели на PHP + Symfony + PostgreSQL + VueJS, но спустя 3 года поддержки я пересмотрел технический стек для бекенда, и вот почему.</p><figure><img src=/posts/tech-stack-reevaluation/cover.jpg width=550px></figure><h2 id=давайте-разбираться>Давайте разбираться</h2><p>Мне нравится современный <a href=https://www.php.net/>PHP</a>. Этот язык здорово развился за последние несколько лет: разработчики прокачали как сам язык, так и его перформанс. PHP оброс инфраструктурой и в сообществе разработки все чаще вспоминают <a href=https://laravel.com/>Laravel</a>, как хороший пример простого фреймворка с низким порогом входа и кучей возможности. Появился <a href=https://getrector.com/demo>rector</a>, который существенно упрощает миграцию, как для популярных библиотек, так и для версий языка(rector сам меняет ваш код, применяя возможности из новых версий и заменяет то, что стало недоступно). Минусы, в общем-то, никуда не делись, но если признавать их и знать, как с ними работать, то проблем особо и нет.</p><p>С 2014 года я использую <a href=https://symfony.com/>Symfony</a>. Это серьезный фреймворк, который из коробки дает отличную базу для разработки приложений, следуя лучшим практикам (зачастую заимствованных из Java), и обладая из-за этого более высоким порогом входа, по сравнению с Laravel, например. Это хороший фреймворк для работы в команде, но стоит признать, что часто мы тратили больше времени на конфигурацию, нежели чем на кодинг.</p><p><a href=https://www.postgresql.org/>PostgreSQL</a> - мощная, бесплатная и открытая СуБД с возможностью гибкого скейлинга и различных конфигураций для разных кейсов, от хайлоада до биг-даты. Является выбором по-умолчанию для многих разработчиков с разных ЯП.</p><p>Вы можете сказать, что у представленных инструментов есть куча проблем и сложностей (и будете правы), но речь будет не об этом.</p><p>В мире разработки курсируют два основных мнения:</p><ul><li>Для быстрого старта начинай использовать то, что хорошо знаешь;</li><li>Под каждую задачу нужно использовать тот инструмент, который подходит для решения этой задачи.</li></ul><p>В 2021 году я считал, что мой стек соответствует обоим пунктам, но спустя 3 года могу рассказать в чем я заблуждался (и это не про перформанс).</p><h3 id=инфраструктура-и-ее-эксплуатация>Инфраструктура и ее эксплуатация</h3><p>Я понимаю, что я не DevOps и поэтому предпочитаю держать свою инфраструктуру максимально простой - так меньше потенциальных проблем, плюс легко написать <a href=https://docs.ansible.com/>Ansible</a>-скрипты. Для личных проектов скейлинг и прочие радости хайлоада не нужны, а вот наличие бэкапов и Infrastructure as Code - считаю must have.</p><p>Если не устанавливать PHP в систему, а использовать Docker-compose, то для проектов с низким трафиком проблем точно не будет. Единство окружений - это удобно для разработки. С rector обновление версий не выглядит сложным, но все равно значительное время придется потратить, чтобы отревьювить изменения и провести регресс.</p><p>PostgreSQL тоже можно использовать в Docker-compose, но придется повозиться с налаживанием бекапов, а так же с процессом обновления (особенно мажорных версий). Это незаметно, пока работаешь в команде с выделенными ролями, но когда начинаешь заниматься этим сам в свободное от работы время (пет-проект же), то понимаешь, что это довольно ресурсоёмко.</p><p>Чтобы убрать с себя часть нагрузки, я решил попробовать <a href=https://www.digitalocean.com/products/app-platform>AppPlatform от DigitalOcean</a>. Просто предоставил docker-образ с приложением, заказал <a href=https://www.digitalocean.com/products/managed-databases-postgresql>Managed PostgreSQL</a> и довольный начал платить $50 в месяц за эту красоту. И все это на минимально возможных мощностях.</p><h3 id=поддержка-и-обновление-пакетов>Поддержка и обновление пакетов</h3><p>Symfony динамично развивается, и за 3 года успешно представил 2 новых мажорных версии фреймворка. Я изначально приземлился на LTS версию с желанием не обновляться часто, однако мой <code>deprecation.log</code> выглядит уже не очень. Использовать rector для обновления версий пакетов мне не удалось, так как есть разные зависимости.
В какой-то момент <a href=https://github.com/dependabot>Dependabot</a> принес мне критическое обновление версии одного из core-пакетов, что потянуло за собой обновления других пакетов, и в итоге поломав мне авторизацию. Изменения пришлось откатить и от обновления временно отказаться.</p><h3 id=неочевидно-на-первый-взгляд>Неочевидно на первый взгляд</h3><p>Возвращаясь к тому, что я осознал, что не верно выбрал стек для проекта, мне бы хотелось немного подробнее раскрыть мысль.</p><p>Благодаря принципу</p><blockquote><p>Для быстрого старта начинай использовать то, что хорошо знаешь</p></blockquote><p>я быстро стартовал и мы начали использовать <a href=https://econumo.com>econumo</a> уже спустя пару недель, что дало мне <a href=https://kuznetsov.dev/posts/development-for-the-soul/>мотивацию</a> продолжать работать над проектом, улучшая и адаптируя его под наши нужды.</p><p>А вот когда я думал про</p><blockquote><p>Под каждую задачу нужно использовать инструмент, который подходит для решения этой задачи.</p></blockquote><p>я оценивал сам проект с технической точки зрения. Это личный проект, нагрузка отсутствует, потенциально open source. Реляционная СуБД подходит отлично. PHP проблем не вызовет. Если очень захочется - можно масштабировать горизонтально.</p><p>Однако, на более продолжительной дистанции, вектор оценки оказался не полным, и я увяз с инфраструктурой и пакетами, увеличивая риск демотивации и остановки развития и поддержки проекта. Добавилось еще то, что спустя год хостинга я понял, что потратил $600 чисто на инфраструктуру, что для хобби не так уж и много, но в целом можно было бы потратить на что-то другое.</p><h3 id=солопренерство>Солопренерство</h3><p>Я почти смирился с тем, что застрял на старых версиях в моменте. А потом купил VPS за $5 на Hetzner и развернул всю инфраструктуру в докере, снизив регулярные расходы в 10 раз. К слову, за год ничего не произошло и все работает стабильно.</p><p>Но мысль о том, что что-то не так, не давала мне покоя. А потом я наткнулся на любопытное видео - <a href="https://youtu.be/lASLZ9TgXyc?si=S8iUgjFWxhiC-gma">https://youtu.be/lASLZ9TgXyc?si=S8iUgjFWxhiC-gma</a> (htmx тут не при чем) и меня осенило, как можно делать иначе.</p><p>Стало понятно, что если бы это был коммерческий проект и работа была в команде, то проблем бы не было. Однако, основное ограничение, которое было не очевидно на старте - это я сам. А точнее то, что я работаю один над проектом, имея в запасе нерегулярные часы, которые я могу уделить разработке. Я понял, что я могу тратить минимальные ресурсы на поддержку инфраструктуры и обновление зависимостей, если скорректирую стек.</p><h2 id=замена>Замена</h2><p>Я решил поменять PostgreSQL на <a href=https://www.sqlite.org/>SQLite</a>. Первичная реакция у многих разработчиков была такой: &ldquo;ты дебил?&rdquo;.
Но если отбросить привычные доводы, то остается набор сухих фактов:</p><ul><li>SQLite - это либа, очень стабильная. SQLite3 уже порядка 20 лет. Мигрировать базу не надо, обновления приходят с операционной системой. Обратная совместимость 100%.</li><li>Делать бэкапы ну очень просто, не нужно никаких дополнительных тулзов, особенно, пока база небольшая.</li><li>Запускать новые окружения, гонять тесты в CI, дебажить проблемы очень просто - достаточно скопировать/создать файл базы.</li><li>Для <a href=https://econumo.com>econumo</a> не требуется интенсивная запись, но требуется много чтения. И в этом SQLite хорош!</li></ul><p>В общем, я экспортировал SQL из PostgreSQL и создал SQLite базу на его основе - ни единой проблемы!
Во время адаптации приложения я столкнулся с некоторыми проблемами (об этом ниже), но в целом миграция из одной СуБД в другую прошла довольно успешно.
И как бонус, по сравнению со средним response time в облаке DO за $50 в месяц в 400мс, response time для $5 VPS с SQLite упал до 50ms.</p><h2 id=осознание>Осознание</h2><p>Во время миграции я столкнулся с некоторыми особенностями реализации адаптера SQLite для <a href=https://www.doctrine-project.org/>Doctrine</a> (например, работа с date-полями в SQLite), из-за которых вместо использования ORM методов я просто перешел на обычные SQL-запросы в репозиториях. И это стриггерило меня на следующие мысли:</p><ol><li>Если бы я просто использовал PDO с обычными SQL-запросами, то достаточно было бы просто заменить конфигурацию проекта.</li><li>Мнение, что Doctrine предоставляет универсальный интерфейс и позволяет легко мигрировать с одной СуБД на другую - ошибочно. Doctrine предоставляет универсальный интерфейс, что усложняет миграцию, так как ты не знаешь, реализованы ли все необходимые абстракции и функции.</li><li>Doctrine предоставила несколько классных инструментов: репозитории, меппинг данных на сущности, фикстуры и миграции. Но их довольно просто можно реализовать самому в минимально необходимом виде.</li><li>Я себя поймал на мысли, что я забыл синтаксис SQL для создания/обновления таблиц, индексов, внешних ключей, так как привык генерировать их через Doctrine. А когда начал генерировать миграции для SQLite нашел пару неявных багов, которые я бы не заметил, если бы не разбирался с работой внешних ключей в SQLite.</li></ol><p>Доктриной мысли не ограничились и привели меня к тому, что для единственного разработчика вся эта абстракция, которая изначально воспринималась как благо, на самом деле является проблемой.
Если ты опытный разработчик, то тебе не нужны все эти академически правильные библиотеки и абстракции. Ты прекрасно можешь спроектировать приложение, которое будет выполнять свою функцию и без фреймворка.
Когда приложение большое, и над ним работает команда - тогда готовая архитектура и фреймворки помогают синхронизироваться команде, упрощают онбординг младших разработчиков и передачу знаний и кода. А когда ты один - тебе это не нужно.
Я осознал, что не нужны мне все эти внешние библиотеки и зависимости. Я и сам прекрасно могу реализовать очень простой Dependency Injection, контроллеры, репозитории, авторизацию и т.д. И это будет гораздо проще и гибче, так как я решаю свои конкретные задачи. Обновлять такой проект будет очень просто и быстро.</p><p>Переписывать, конечно, я проект сейчас уже не возьмусь, но выводы на будущее сделал.</p><h2 id=go-go-go>Go-go-go</h2><p>После еще некоторого размышления, я подумал, а какая технология сделала бы поддержку проекта максимально простой, сопоставимой с SQLite? В приведенном выше youtube-видео, докладчик использует node, что несильно отличается от PHP, но мысль такая, что node - простой и стабильный фреймворк, который почти не меняется.</p><p>Я решил абстрагироваться, и начал перебирать в голове языки программирования, которые</p><ul><li>компилируемые (проект не соберется пока есть ошибки);</li><li>кросс-платформенный (тут как минимум linux/amd64, linux/arm64 или mac os);</li><li>с хорошей стандартной библиотекой, которая не меняется часто (не нужно тянуть много зависимостей);</li><li>простые.
И осознал, что это ж <a href=https://go.dev/>Go</a>!</li></ul><p>В дополнение к списку выше стало понятно, что для него даже Docker не нужен, а сервис запускается прекрасно через systemctl.
Про проблемы производительности вообще можно забыть. А значит можно хостить много приложений на VPS за $5!</p><h2 id=выводы>Выводы</h2><p>После трех лет работы над своим пет-проектом, я пересмотрел выбранный технический стек в пользу:</p><ul><li>CloudFlare - dns-хостинг + выпуск и обновление SSL-сертификатов (бесплатно).</li><li>VPS на любом хостинге (я использовал DigitalOcean, Hetzner и сейчас сижу на бесплатном OracleCloud).</li><li>NGINX - в качестве реверс-прокси. Легко настраивается, обеспечивает безопасный коннект между cloudflare и сервером.</li><li>GO - в качестве языка разработки. Компилируемый, кросс-платформенный, простой язык с хорошей стандартной библиотекой.</li><li>SQLite - простейшая СуБД, которую не нужно обновлять, и которую легко бекапить. В случае чего - легко мигрировать данные в другую СуБД, либо использовать Turso.</li></ul><p>А так же включил в оценку проекта фактор КТО, КОГДА, и КАК ДОЛГО будет заниматься его поддержкой.
А вообще сейчас размышляю, а нужны ли все эти многослойности в коммерческой разработке, но это отдельный вопрос.</p><hr><p>Что касается фронтенда - там все немного сложнее, но проскальзывают рекомендации использовать
<a href=https://htmx.org/>HTMX</a> и <a href=https://alpinejs.dev/>Alpine.js</a>. Сам пока не пробовал, но как разберусь, напишу отдельный пост.</p></div><div class=post__footer><span><a class=tag href=/tags/experience/>experience</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Дмитрий Кузнецов
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>