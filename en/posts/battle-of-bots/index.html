<!doctype html><html dir=ltr lang=en data-theme=dark class="html theme--dark"><head><title>Dmitry Kuznetsov
|
Battle of Bots for visa</title><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Dmitry Kuznetsov"><meta name=description content="How I created a bot that monitored available time slots at the visa center and rescheduled appointments."><link rel=alternate href=/en/posts/battle-of-bots/ hreflang=en><link rel=alternate href=/posts/battle-of-bots/ hreflang=ru><link rel=stylesheet href=/scss/main.min.99393b720daa0e4e122d508358dfaa568774f7a5871f48ec1a496f33e554dae6.css integrity="sha256-mTk7cg2qDk4SLVCDWN+qVod096WHH0jsGklvM+VU2uY=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/override.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/404.min.8af5cba8db45fcd9bffa951d2cb07c1b34c55055091a151d255d39bc2ccfc919.css integrity="sha256-ivXLqNtF/Nm/+pUdLLB8GzTFUFUJGhUdJV05vCzPyRk=" crossorigin=anonymous media=screen><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=https://kuznetsov.dev/en/posts/battle-of-bots/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/redirect.min.1a0a0ecc7df8adf287ef6a14f5a4fb7a38bd4cf3e64b85aa9580556790d51e13.js integrity="sha256-GgoOzH34rfKH72oU9aT7eji9TPPmS4WqlYBVZ5DVHhM=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Battle of Bots for visa"><meta name=twitter:description content="How I created a bot that monitored available time slots at the visa center and rescheduled appointments."><meta property="og:title" content="Battle of Bots for visa"><meta property="og:description" content="How I created a bot that monitored available time slots at the visa center and rescheduled appointments."><meta property="og:type" content="article"><meta property="og:url" content="https://kuznetsov.dev/en/posts/battle-of-bots/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-21T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-21T00:00:00+00:00"><meta property="og:site_name" content="Cult of Quality"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Battle of Bots for visa","headline":"Battle of Bots for visa","alternativeHeadline":"","description":"
      How I created a bot that monitored available time slots at the visa center and rescheduled appointments.


    ","inLanguage":"ru","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kuznetsov.dev\/en\/posts\/battle-of-bots\/"},"author":{"@type":"Person","name":"Dmitry Kuznetsov"},"creator":{"@type":"Person","name":"Dmitry Kuznetsov"},"accountablePerson":{"@type":"Person","name":"Dmitry Kuznetsov"},"copyrightHolder":{"@type":"Person","name":"Dmitry Kuznetsov"},"copyrightYear":"2023","dateCreated":"2023-05-21T00:00:00.00Z","datePublished":"2023-05-21T00:00:00.00Z","dateModified":"2023-05-21T00:00:00.00Z","publisher":{"@type":"Organization","name":"Dmitry Kuznetsov","url":"https://kuznetsov.dev/","logo":{"@type":"ImageObject","url":"https:\/\/kuznetsov.dev\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/kuznetsov.dev\/en\/posts\/battle-of-bots\/","wordCount":"1197","genre":[],"keywords":["n8n","automation"]}</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-KJG8966")</script></head><body class=body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KJG8966" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
."><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/avatar-qq.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/en>Dmitry Kuznetsov</a></div><div class=sidebar__introduction-description><p>[Cult of Quality]</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href target=_blank rel="noopener me" aria-label title><i class=fa-2x aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.linkedin.com/in/kuznetsovdy target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin-in fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/dmkuznetsov target=_blank rel="noopener me" aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://t.me/kuznetsov_dev target=_blank rel="noopener me" aria-label=Telegram title=Telegram><i class="fab fa-telegram-plane fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/dmitry_ops target=_blank rel="noopener me" aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Dmitry Kuznetsov
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class=.><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/en/ title>Posts</a></li><li class=nav__list-item><a href=/en/posts/ title>Posts archive</a></li><li class=nav__list-item><a href=/en/about/ title>About me</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=optionswitch><input class=optionswitch__picker type=checkbox id=languagepicker hidden>
<label class=optionswitch__label for=languagepicker>EN <i class="fa fa-angle-down" aria-hidden=true></i></label><div class=optionswitch__triangle></div><ul class=optionswitch__list><li class=optionswitch__list-item><a href=/posts/battle-of-bots/ title=RU><span aria-label=RU>RU</span></a></li></ul></div></li></ul></nav></div></header><div class="post
."><div class=post__content><h1>Battle of Bots for Visa</h1><p>With the advent of total digitalization, procedures such as online appointment scheduling have become quite common. However, many organizations still struggle to handle the influx of applications, leading to waiting times of months, if not years.</p><p>It&rsquo;s understandable that queues and long waiting times often occur in places where resources are severely limited. However, even the system itself, which manages the electronic queue, is far from perfect.</p><h2 id=case-of-visa-application>Case of Visa Application</h2><p>My wife and I decided to apply for tourist visas to a certain country. We prepared all the necessary documents and paid the fees. But here&rsquo;s the problem: the next available appointment was scheduled for 1.5 years later. When you think about it, the country we wanted to visit as tourists is missing out on tourism revenue, and we&rsquo;re not getting the experience we planned for.</p><p>There are many websites on the internet that offer to reschedule your appointment and significantly reduce the waiting time. How does it work? Someone simply created a bot that monitors available time slots, and with your personal information and access to your account, it reschedules your appointment to the nearest available time.</p><p>A fair question might arise: where do these available time slots come from?
They could be due to the hiring of new employees (both temporary and permanent), cancellations or rescheduling by other applicants, or perhaps only a portion of the possible time intervals was initially made available for scheduling.</p><h3 id=what-can-we-assume-about-the-work-of-visa-centers>What can we assume about the work of visa centers?</h3><p>Before moving forward, let&rsquo;s take a moment to think on how the work of a visa center might be organized. I am not familiar with the actual organization, but from an outside perspective, I can make a few assumptions:</p><ol><li>All public services provided by the visa center are standardized, which means the time allocated for each service is fairly consistent.</li><li>Visa centers offer services both through scheduled appointments and live queues. If one of the specialists responsible for appointments goes on vacation or falls ill, it is possible to either temporarily increase resources or redistribute them from the live queue (when making an appointment, the center commits to serving the client at a specific time, while no such commitment is made for the live queue).</li><li>If there is no live queue and no possibility to expand resources, it is initially easier (from the visa center&rsquo;s perspective) to allocate a smaller number of available time slots to visit in order to mitigate risks and human factors.</li></ol><h3 id=appointment-scheduling-issue>Appointment scheduling issue</h3><p>No one experiences negativity when they manage to schedule an appointment in the near future.
We would be satisfied if we could see a dentist for an urgent appointment today and schedule a preventive check-up within a couple of weeks. The same goes for visas â€” it would be great to have a visa within a month, but certainly not after a year.</p><p>But here we are. We were able to schedule an appointment for a date that is 1.5 years from now.</p><p>Naturally, we are not willing to accept such a long waiting period, so I started looking for options to receive notifications about the availability of earlier time slots.</p><h2 id=the-birth-of-another-bot>The birth of another bot</h2><p>After googling and searching on GitHub, I managed to find several Python scripts that would notify you by email when a free date became available. The scripts were fairly simple, but I didn&rsquo;t want to set up Python on my VPS. I decided to transfer the logic from the script to the tool I already had.</p><p>I&rsquo;ve previously written about <a href=/posts/n8n>n8n (an open-source alternative to Zapier)</a>. The utility provides a wide range of possibilities, including the ability to schedule automations.</p><p>As it turned out, <a href=/posts/n8n>n8n</a>, in addition to its extensive library of pre-built integrations, allows the installation of &ldquo;community nodes.&rdquo; Essentially, these are plugins supported by the community.</p><p>The visa center made the authentication process quite complicated by implementing reCAPTCHA and taking other measures that made it extremely difficult to write a bot using cURL. Therefore, I set up <a href=https://github.com/minhlucvan/n8n-nodes-browserless>n8n + browserless integration</a>, which allowed me to write bots using <a href=https://pptr.dev/>Pupeeter</a>. Essentially, this tool launches Chrome in headless mode and allows interaction with the page as if it were opened in a browser. Consequently, all content is loaded as expected, and if a little randomness is added, even reCAPTCHA ceases to be a problem.</p><p>The bot grew quickly because n8n allows you to quickly build logic. The overall workflow looked something like this:</p><p><img src=workflow.jpg alt="Visa workflow"></p><p>When a free time slot became available, my bot would send a notification to Telegram and then attempt to automatically book it. It also took into account various peculiarities of the specific visa center. For example, my account could be temporarily blocked, even if you check the time slots every ten minutes or so.</p><h2 id=battle-of-bots>Battle of bots</h2><p><img src=preview.jpg alt="Battle of bots"></p><p>Once the bot was up and running, it became apparent that there were several similar bots active on the center&rsquo;s website. Free slots would appear regularly but disappear instantly. We could only rely on good timing and hope that our bot would be faster at some point.</p><p>Within a month, the bot found and booked a time slot, thus reducing the waiting time from 1.5 years to 4 weeks.</p><h2 id=how-it-could-have-been-different>How it could have been different?</h2><p>I started to think because such bots are a workaround. Due to the visa center&rsquo;s failure to consider the clients&rsquo; needs, a small but understandable market for such bots emerged.</p><p>If we think again, we can get rid of this workaround at the booking logic level.</p><ol><li>There are clients who are satisfied with the waiting time and a fixed appointment date and time. Nothing needs to be changed for them.</li><li>There are clients who would like to reschedule their booking to an earlier period, with specific preferences for the day of the week and time (for example, someone may work on alternate days without the possibility of missing a shift).</li><li>There are clients who would like to reschedule their booking to an earlier period and are willing to adapt.</li></ol><p>In fact, the visa center could have organized an internal queue for those who wanted to reschedule and hidden the option to reschedule to earlier time slots from the website when they became available.</p><p>If a booking could be rescheduled, the center could send an email notification, and the visitor would have a X number of hours to click on a link to confirm the rescheduling (or decline it).</p><p>By implementing such a solution, the conditions for everyone wishing to visit the visa center would be the same, and there would be no point in developing bots.</p><p>Did the visa center save anything by not implementing such a logic? No.
Due to the influx of bots, they had to introduce reCAPTCHA, implement custom token handling logic, enforce account blocking for frequent logins, and so on.</p><p>Is it difficult to implement rescheduling logic within the system? No.
One could start with a simple choice:</p><ul><li>The booking date and time are satisfactory.</li><li>I want to reschedule to an earlier period and am okay to change date and time.</li></ul><p>Clients would then have a transparent interaction mechanism (to the extent possible).</p><p><em>Translated by ChatGPT</em></p></div><div class=post__footer><span><a class=tag href=/en/tags/n8n/>n8n</a><a class=tag href=/en/tags/automation/>automation</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Dmitry Kuznetsov
2024</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>